<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Task 12</title>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
          integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
          crossorigin="anonymous"></script>

  <script>
   
    function addPostRow(data) {
      const $p = $('<p></p>').attr('id', 'row-' + data.id);

      /
      const $deleteSpan = $('<span>(delete)</span>').css({
        'color': 'red',
        'cursor': 'pointer',
        'margin-right': '10px'
      });

     
      $deleteSpan.on('click', function() {
        deletePost(data.id);
      });

     
      const $infoSpan = $('<span></span>').text(
        `Post created with id ${data.id}, title: ${data.title}, author: ${data.author}`
      );

      
      $p.append($deleteSpan, $infoSpan);

      $('body').append($p);
    }

    
    function deletePost(id) {
      $.ajax({
        url: 'http://localhost:3000/posts/' + id,
        method: 'DELETE'
      })
      .done(function() {
        
        $('#row-' + id).remove();
      })
      .fail(function() {
        alert('Post was not deleted');
      });
    }

    function listPosts() {
      $.get('http://localhost:3000/posts')
        .done(function (data) {
          data.forEach(post => addPostRow(post));
        })
        .fail(function () {
          alert('Server Error');
        });
    }

    function buildForm() {
      const $form = $('<form></form>');

      const $authorDiv = $('<div></div>');
      const $authorLabel = $('<label for="author">Author</label>');
      const $authorInput = $('<input type="text" id="author" />');
      $authorDiv.append($authorLabel, $authorInput);

      const $titleDiv = $('<div></div>');
      const $titleLabel = $('<label for="title">Title</label>');
      const $titleTextarea = $('<textarea id="title"></textarea>');
      $titleDiv.append($titleLabel, $titleTextarea);

      const $submit = $('<input type="submit" value="Submit" />');

      $form.append($authorDiv, $titleDiv, $submit);
      $('body').append($form);

      $form.on('submit', function (e) {
        e.preventDefault();
        sendForm();
      });
    }

    function sendForm() {
      const $form = $('form').first();

      $('.sending-message').remove();
      $form.after('<p class="sending-message">About to send the query to the API</p>');

      const data = {
        author: $('#author').val(),
        title: $('#title').val()
      };

      $.post('http://localhost:3000/posts', data)
        .done(function (response) {
          addPostRow(response);
        })
        .fail(function () {
          alert('Error sending the POST query');
        });
    }

    $(document).ready(function () {
      listPosts();
      buildForm();
    });
  </script>
</head>
<body>
</body>
</html>
